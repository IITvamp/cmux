{"type":"agent-turn-complete","turn-id":"1","input-messages":["I’ll start by scanning the repo for terminal/escape-sequence handling and how agent CLIs are launched to pinpoint the source.","I’ll start by scanning the repo for terminal/escape-sequence handling and how agent CLIs are launched to pinpoint the source.","Scanning repo for agent-launch code, PTY/stdio piping, and ANSI handling.Scanning repo for agent-launch code, PTY/stdio piping, and ANSI handling.","Now I’ll open the server spawner and client task run view to inspect output handling.","Now I’ll open the server spawner and client task run view to inspect output handling.","I’m going to update the tmux config to use xterm-256color and proper overrides, which should stop raw escape sequences from showing at startup.","I’m going to update the tmux config to use xterm-256color and proper overrides, which should stop raw escape sequences from showing at startup."],"last-assistant-message":"Summary: fixed stray escape codes on agent startup\n\n- Root cause: tmux was advertising TERM as tmux-256color inside the worker. VS Code’s integrated terminal (xterm.js) doesn’t fully support that terminfo, so some OSC/CSI sequences (e.g., title updates, bracketed paste toggles) printed literally at startup when Claude/Codex CLIs launched in tmux.\n- Fix: switched tmux to xterm-256color with RGB override for truecolor, which xterm.js supports cleanly.\n\nWhat I changed\n- configs/tmux.conf: set default terminal and color override\n  - From: set -g default-terminal \"tmux-256color\"\n  - To: set -g default-terminal \"xterm-256color\"\n  - Added: set -as terminal-overrides ',xterm-256color:RGB'\n\nWhy this works\n- VS Code’s terminal emulation matches xterm-256color. Using tmux-256color can leak raw sequences (e.g., ]0;…, [?2004h) as visible “random characters” when xterm.js doesn’t interpret tmux-specific capabilities.\n\nNext steps to verify\n- Rebuild worker image and run once to pick up tmux.conf:\n  - ./scripts/dev.sh --force-docker-build\n  - Start a task that spawns Claude/Codex and open the terminal; the random preamble should be gone.\n- Optional: run typechecking at root when done: bun run typecheck\n\nIf anything still shows, I can add an extra guard to sanitize any remaining OSC title sequences in idle detection or terminal piping, but this change should address the startup artifact you reported."}
