{
	auto_https off
}

:80 {
	# Single reverse proxy that handles both WebSocket and HTTP
	reverse_proxy cmux-proxy:3000 {
		# Pass through all incoming headers (including WebSocket upgrade headers)
		header_up Host {host}
		header_up X-Real-IP {remote}
		header_up X-Forwarded-For {remote}
		header_up X-Forwarded-Proto {scheme}

		# Disable buffering for WebSocket connections
		flush_interval -1

		# Increase timeout for long-lived WebSocket connections
		transport http {
			read_timeout 0
			write_timeout 0
		}
	}
}
